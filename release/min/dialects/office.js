Md.extend("syntax/block",function(n){function e(){this.lib=[]}var t=n("node");return e.prototype.extend=function(n){this.lib.push(n)},e.prototype.parse=function(n){var e,i=[n],r=null,l=this.lib.length,a=null,s=new t;do for(n=i.pop(),e=0;e<l;e++){if(r=[],a=this.lib[e].parse(n,r),r.length&&(r.reverse(),i.push.apply(i,r)),a){s.appendChild(a);break}r.length&&(n=i.pop())}while(i.length);return s},e.expend=function(n){expendGrammars.push(n)},e}),Md.extend("syntax/inline",function(n){function e(){this.lib=[]}var t=n("node");return e.prototype.extend=function(n){this.lib.push(n)},e.prototype.parse=function(n){var e,i=[n],r=null,l=this.lib.length,a=null,s=new t;do for(n=i.pop(),e=0;e<l;e++){if(r=[],a=this.lib[e].parse(n,r),r.length&&(r.reverse(),i.push.apply(i,r)),a){s.appendChild(a);break}r.length&&(n=i.pop())}while(i.length);return s},e}),Md.extend("syntax/combin-block",function(n){function e(n){this.block=n.getSyntax("block"),this.block.extend(this)}var t=n("node");return e.prototype.parse=function(n){var e=n.split(/(?:^\s*\n)/m),i=this;return e.length>1?function(){for(var n=new t,r=0,l=e.length;r<l;r++)n.appendChild(i.block.parse(e[r]));return n}():null},e}),Md.extend("syntax/atx-header",function(n){function e(n){var e=n.getSyntax("block");e.extend(this),this.inline=n.getSyntax("inline")}var t=n("node"),i=/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/;return e.prototype.parse=function(n,e){if(!i.test(n))return null;var r=n.match(i),l=new t("h"+r[1].length);return l.appendChild(this.inline.parse(r[2])),r[0].length<n.length&&e.push(n.substr(r[0].length)),l},e}),Md.extend("syntax/setext-header",function(n){function e(n){block=n.getSyntax("block"),block.extend(this),this.inline=n.getSyntax("inline")}var t=n("node");return e.prototype.parse=function(n,e){var i=/^(.*)\n([-=])\2\2+(?:\n|$)/,r=null,l="",a=null;return i.test(n)?(r=n.match(i),l="="===r[2]?"h1":"h2",a=new t(l),a.appendChild(this.inline.parse(r[1])),r[0].length<n.length&&e.push(n.substr(r[0].length)),a):null},e}),Md.extend("syntax/list",function(n){function e(n){var e=n.getSyntax("block");e.extend(this),this.inline=n.getSyntax("inline")}function t(n,e){return n.replace(/(?: {0,3}\\t| {4})/,"\t").length}function i(n,e,l,a){function s(n,t){c=new r("li").appendChild(n),e=t}for(var u,o=n.length,p=new r("ul"),h=/^(\s*)([*+-]|\\d+\\.)[ \t]+(.*)/,d=null,c=null;e<o;e++){if(d=n[e].match(h),u=t(d[1]),u>l)i.call(this,n,e,l+1,s);else{if(u<l)break;c=this.inline.parse(d[3]),c=new r("li").appendChild(c)}p.appendChild(c)}a(p,e)}var r=n("node");return e.prototype.parse=function(n,e){var t,r=n.match(/^(?: *(?:[*+-]|\\d+\\.)[ \t]+.*(\n|$))+/),l=null;return r?(r[0].length<n.length&&e.push(n.substr(r[0].length)),l=r[0].split("\n"),""===l[l.length-1]&&l.pop(),i.call(this,l,0,0,function(n){t=n}),t):null},e}),Md.extend("syntax/code",function(n){function e(n){var e=n.getSyntax("block");e.extend(this)}var t=n("node"),i=n("text-node");return e.prototype.parse=function(n,e){var r=/^(?: {0,3}\t| {4})(.*)\n?/gm,l=/\s*\[(.*?)\](?:\s*\[(.*?)\])?[ \t]*/,a=[],s=null,u={language:null,lineNum:0},o=null,p=0;if(!/^(?: {0,3}\t| {4})(.*)/.test(n))return null;for(s=r.exec(n);s;s=r.exec(n))a.push(s[1]),p=r.lastIndex;return p<n.length&&e.push(n.substr(p)),s=l.exec(a[0]),s&&(a.shift(),s[1]&&(u.language=s[1]),s[2]&&(u.lineNum=s[2])),o=new t("pre").appendChild(new t("code").appendChild(new i(a.join("\n"))))},e}),Md.extend("syntax/horiz-line",function(n){function e(n){var e=n.getSyntax("block");e.extend(this)}var t=n("node"),i={dash:"dash",underline:"underline",asterisk:"asterisk"};return e.prototype.parse=function(n,e){var r=/^(?:([\s\S]*?)\n)?[ \t]*(([-_*])(?:[ \t]*\3){2,})[ \t]*(?:\n([\s\S]*))?$/,l=n.match(r),a=null;if(!l)return null;if(l[1])return e.push(l[1]),e.push(l[2]),l[4]&&e.push(l[4]),null;switch(a=new t("hr"),l[3]){case"-":a.attr("class",i.dash);break;case"_":a.attr("class",i.underline);break;case"*":a.attr("class",i.asteris)}return l[4]&&e.push(l[4]),a},e}),Md.extend("syntax/paragraph",function(n){function e(n){block=n.getSyntax("block"),block.extend(this),this.inline=n.getSyntax("inline")}var t=n("node");return e.prototype.parse=function(n){var e=new t("p");return e.appendChild(this.inline.parse(n)),e},e}),Md.extend("syntax/escaped",function(n){function e(n){var e=n.getSyntax("inline");e.extend(this)}var t=n("text-node");return e.prototype.parse=function(n,e){var i=/\\([\\`\*_{}\[\]()#\+.!\-])/,r=i.exec(n);return i.test(n)?0===r.index?(e.push(n.substr(r[0].length)),new t(r[1])):(e.push(n.substring(0,r.index)),e.push(n.substr(r.index)),null):null},e}),Md.extend("syntax/inline-plain-text",function(n){function e(n){var e=n.getSyntax("inline");e.extend(this)}var t=n("text-node");return e.prototype.parse=function(n){return new t(n)},e}),Md.extend("dialects/office",function(n){var e=n("dialect-builder");return(new e).setSyntax(["block","inline","combin-block","atx-header","setext-header","list","code","horiz-line","paragraph","escaped","inline-plain-text"]).build()});