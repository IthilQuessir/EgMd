Md.extend("syntax/block",function(n){function e(){this.lib=[]}var t=n("node");return e.prototype.extend=function(n){this.lib.push(n)},e.prototype.parse=function(n){var e,r=[n],i=null,l=this.lib.length,s=null,o=new t;do for(console.log("[Block parse1] ",n,r),n=r.pop(),console.log("[Block parse2] ",n,r),e=0;e<l;e++){if(i=[],s=this.lib[e].parse(n,i),console.log("[Block parse] try result ",s,i),i.length&&(i.reverse(),r.push.apply(r,i)),s){o.appendChild(s);break}i.length&&(n=r.pop())}while(r.length);return o},e.expend=function(n){expendGrammars.push(n)},e}),Md.extend("syntax/inline",function(n){function e(){this.lib=[]}var t=n("node");return e.prototype.extend=function(n){this.lib.push(n)},e.prototype.parse=function(n){var e,r=[n],i=null,l=this.lib.length,s=null,o=new t;console.log("[Inline parse]",n);do for(n=r.pop(),e=0;e<l;e++){if(i=[],s=this.lib[e].parse(n,i),i.length&&(i.reverse(),r.push.apply(r,i)),s){o.appendChild(s);break}i.length&&(n=r.pop())}while(r.length);return o},e}),Md.extend("syntax/combin-block",function(n){function e(n){this.block=n.getSyntax("block"),this.block.extend(this)}var t=n("node");return e.prototype.parse=function(n){var e=n.split(/(?:^\s*\n)/m),r=this;return console.log("[CombinBlock parse] ",e,e.length),e.length>1?function(){for(var n=new t,i=0,l=e.length;i<l;i++)n.appendChild(r.block.parse(e[i]));return n}():null},e}),Md.extend("syntax/atx-header",function(n){function e(n){var e=n.getSyntax("block");e.extend(this),this.inline=n.getSyntax("inline")}var t=n("node"),r=/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/;return e.prototype.parse=function(n,e){if(!r.test(n))return null;var i=n.match(r),l=new t("h"+i[1].length);return l.appendChild(this.inline.parse(i[2])),i[0].length<n.length&&e.push(n.substr(i[0].length)),l},e}),Md.extend("syntax/setext-header",function(n){function e(n){block=n.getSyntax("block"),block.extend(this),this.inline=n.getSyntax("inline")}var t=n("node");return e.prototype.parse=function(n,e){var r=/^(.*)\n([-=])\2\2+(?:\n|$)/,i=null,l="",s=null;return r.test(n)?(i=n.match(r),l="="===i[2]?"h1":"h2",s=new t(l),s.appendChild(this.inline.parse(i[1])),i[0].length<n.length&&e.push(n.substr(i[0].length)),s):null},e}),Md.extend("syntax/horiz-line",function(n){function e(n){var e=n.getSyntax("block");e.extend(this)}var t=n("node"),r={dash:"dash",underline:"underline",asterisk:"asterisk"};return e.prototype.parse=function(n,e){var i={s:n};console.log("[HorizLine parse] ",i);var l=/^(?:([\s\S]*?)\n)?[ \t]*(([-_*])(?:[ \t]*\3){2,})[ \t]*(?:\n([\s\S]*))?$/,s=n.match(l),o=null;if(!s)return null;if(s[1])return e.push(s[1]),e.push(s[2]),s[4]&&e.push(s[4]),null;switch(o=new t("hr"),s[3]){case"-":o.attr("class",r.dash);break;case"_":o.attr("class",r.underline);break;case"*":o.attr("class",r.asteris)}return s[4]&&e.push(s[4]),o},e}),Md.extend("syntax/paragraph",function(n){function e(n){block=n.getSyntax("block"),block.extend(this),this.inline=n.getSyntax("inline")}var t=n("node");return e.prototype.parse=function(n){var e=new t("p");return e.appendChild(this.inline.parse(n)),e},e}),Md.extend("syntax/escaped",function(n){function e(n){var e=n.getSyntax("inline");e.extend(this)}var t=n("text-node");return e.prototype.parse=function(n,e){var r=/\\([\\`\*_{}\[\]()#\+.!\-])/,i=r.exec(n);return r.test(n)?0===i.index?(e.push(n.substr(i[0].length)),new t(i[1])):(e.push(n.substring(0,i.index)),e.push(n.substr(i.index)),null):null},e}),Md.extend("syntax/inline-plain-text",function(n){function e(n){var e=n.getSyntax("inline");e.extend(this)}var t=n("text-node");return e.prototype.parse=function(n){return new t(n)},e}),Md.extend("dialects/office",function(n){var e=n("dialect-builder");return(new e).setSyntax(["block","inline","combin-block","atx-header","setext-header","horiz-line","paragraph","escaped","inline-plain-text"]).build()});