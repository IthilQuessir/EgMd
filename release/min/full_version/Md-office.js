!function(t,n){"use strict";function e(t){for(var n=t.split("/"),e=0,r=n.length,i=o;e<r;e++){if(!(n[e]in i))throw new Error("[Md require] Cannot find the module;\nThe url is "+t);i=i[n[e]]}if(n in o)return o[name];throw new Error("CANNOT ")}function r(t,n){for(var r=t.split("/"),i=0,s=r.length-1,l=o,a=null;i<s;i++)r[i]in l||(l[r[i]]={}),l=l[r[i]];if(r[i]in l)throw new Error("[Md extend] Module had existed;\nThe Url is "+t);if(a=n.call(l,e),!a)throw new Error('[Md extend] the module "'+r[i]+'"had existed');l[r[i]]=a}function i(t,n){var e=new Dialect,r=e.parse(t),i=r.toHtml();return this.options=n,i}var o={};i.prototype.extend=r,t.Md=i}(this),Md.extend("attr",function(t){function n(){this.list={}}return n.prototype.add=function(t,n){this.list[t]=n},n.prototype.rm=function(t){delete this.list[t]},n.prototype.get=function(t){return this.list[t]||null},n.prototype.forEach=function(t){var n,e=this.list;for(n in e)e.hasOwnProperty(n)&&t.call(this,n,e[n])},n.prototype.clone=function(){},n}),Md.extend("dialect-builder",function(t){function n(){this.syntaxLib={}}function e(){this.list=[]}n.prototype.parse=function(t){if(!("block"in this.syntaxLib))throw new Error("[Dialect parse] Dialect must has extend block module");this.syntaxLib.block(t)},n.prototype.extend=function(t,n){this.syntaxLib[t]=new n(this)},n.prototype.getSyntax=function(t){if(t in this.syntaxLib)return this.syntaxLib[t];throw new Error("[Dialect getSyntax] This dialect hasn't syntax named "+t)},e.prototype.addSyntax=function(t){this.list.push.apply(this.list,t)},e.prototype.build=function(){for(var e=0,r=this.list.length,i=null,o=new n;e<r;e++)i=t(this.list[e]),o.extend(this.list[e],i)}}),Md.extend("node",function(t){function n(t){this.__tag__=t?t:"",this.__attr__=new e,this.children=[]}var e=t("attr");return n.prototype.attr=function(t,n){return"undefined"==typeof n?this.__attr__.get(t):this.__attr__.add(t,n)},n.prototype.rmAttr=function(t){return this.__attr__.rm(t),this},n.prototype.appendChild=function(t){return this.children.push(t),this},n.prototype.toHtml=function(){var t=null,n=this.children,e=-1,r=n.length;for(""===this.__tag__?t=document.createDocumentFragment():(t=document.createElement(this.__tag__),this.__attr__.forEach(function(n,e){t.setAttribute(n,e)}));++e<r;)t.appendChild(n[e].toHtml());return t},n}),Md.extend("text-node",function(t){function n(t){this.text=t}return n.prototype.toHtml=function(){return document.createTextNode(this.text)},n}),Md.extend("syntax/block",function(t){function n(){this.lib=[]}return n.prototype.extend=function(t){this.lib.push(t)},n.prototype.parse=function(t){var n,e=[t],r=null,i=this.lib.length,o=null;do for(r=[],t=e.pop(),n=0;n<i;n++){if(o=this.lib[n].parse(t,r),r.length&&(r.reverse(),e.push.apply(e,r)),o){node.appendChild(o);break}r.length&&(t=e.pop())}while(e.length);for(;++n<i;)if(grammar=new expendGrammars[n],r=[],o=grammar.parse(t,r),r.length&&null===o)r.reverse(),t=r.pop(),e.push.apply(e,r);else{if(r.length){r.reverse(),e.push.apply(e,r);break}if(null!==o)break}return o},n.expend=function(t){expendGrammars.push(t)},n}),Md.extend("syntax/inline",function(t){function n(){this.lib=[]}return n.prototype.extend=function(t){this.lib.push(t)},n.prototype.parse=function(t){var n,e=[t],r=null,i=this.lib.length,o=null,s=new Node;do for(r=[],t=e.pop(),n=0;n<i;n++){if(o=this.lib[n].parse(t,r),r.length&&(r.reverse(),e.push.apply(e,r)),o){s.appendChild(o);break}r.length&&(t=e.pop())}while(e.length);return s},n}),Md.extend("syntax/combin-block",function(t){function n(t){this.block=t.getSyntax("block"),this.block.extend(this)}return n.prototype.parse=function(t){var n=/($|\n(?:\s*\n|\s*$)+)/,e=t.split(n);if(console.log(e),!(e.length>1))return null},n}),Md.extend("syntax/atx-header",function(t){function n(t){var n=t.getSyntax("block");n.extend(this),this.inline=t.getSyntax("inline")}var e=t("node"),r=/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/;return n.prototype.parse=function(t,n){if(!r.test(t))return null;var i=t.match(r),o=new e("h"+i[1].length);return o.appendChild(new TextNode(i[2])),i[0].length<t.length&&n.push(t.substr(i[0].length)),o},n}),Md.extend("syntax/horiz-line",function(t){function n(t){var n=t.getSyntax("block");n.extend(this)}var e={dash:"dash",underline:"underline",asterisk:"asterisk"};return n.prototype.parse=function(t,n){var r=/^(?:([\s\S]*?)\n)?[ \t]*(([-_*])(?:[ \t]*\3){2,})[ \t]*(?:\n([\s\S]*))?$/,i=t.match(r),o=null;if(!i)return null;if(i[1])return n.push(i[1]),n.push(i[2]),i[4]&&n.push(i[4]),null;switch(o=new Node("hr"),i[3]){case"-":o.attr("class",e.dash);break;case"_":o.attr("class",e.underline);break;case"*":o.attr("class",e.asteris)}return i[4]&&n.push(i[4]),o},n}),Md.extend("syntax/escaped",function(t){function n(t){var n=t.getSyntax("block");n.extend(this)}return n.prototype.parse=function(t,n){var e=/\\([\\`\*_{}\[\]()#\+.!\-])/,r=e.exec(t);return e.test(t)?0===r.index?(n.push(t.substr(r[0].length)),new TextNode(r[1])):(n.push(t.substring(0,r.index)),n.push(t.substr(r.index)),null):null},n}),Md.extend("syntax/inline-plain-text",function(t){function n(){}var e=t("text-node");return n.prototype.parse=function(t){return new e(t)},n}),Md.extend("dialects/office",function(t){t("dialect-builder");return(new dialectBuilder).setSyntax(["block","inline","combin-block","atx-header","horiz-line","pragraph","escaped","inline-plain-text"]).build()});