!function(t,n){"use strict";function e(t){for(var n=t.split("/"),e=0,r=n.length,i=o;e<r;e++){if(!(n[e]in i))throw new Error("[Md require] Cannot find module: "+t);i=i[n[e]]}return i}function r(t,n){for(var r=t.split("/"),i=0,s=r.length-1,l=o,a=null;i<s;i++)r[i]in l||(l[r[i]]={}),l=l[r[i]];if(r[i]in l)throw new Error("[Md extend] Module had existed;\nThe Url is "+t);if(a=n.call(l,e),!a)throw new Error('[Md extend] Unexpected return of the module "'+r[i]+'"');l[r[i]]=a}function i(t,n){var r,i=e("dialects"),o=null;if(n=n||{},n.dialect&&n.dialect in i)o=i[n.dialect];else for(r in i){o=i[r];break}if(!o)throw new Error("[Md] Plese use full_version or include dialect module\n请使用完整版或者 Md-seed.js + dialect模块配合使用。仅单独使用Md-seed.js是无法运行的");return t=t.replace(/^\s*\n/,"").replace(/\s*$/,""),o.parse(t).toHtml()}var o={};i.extend=r,t.Md=i}(this),Md.extend("attr",function(t){function n(){this.list={}}return n.prototype.add=function(t,n){this.list[t]=n},n.prototype.rm=function(t){delete this.list[t]},n.prototype.get=function(t){return this.list[t]||null},n.prototype.forEach=function(t){var n,e=this.list;for(n in e)e.hasOwnProperty(n)&&t.call(this,n,e[n])},n.prototype.clone=function(){},n}),Md.extend("dialect-builder",function(t){function n(){this.syntaxLib={}}function e(){this.list=[]}return n.prototype.parse=function(t){if("block"in this.syntaxLib)return this.syntaxLib.block.parse(t);throw new Error("[Dialect parse] Dialect must has extend block module")},n.prototype.extend=function(t,n){this.syntaxLib[t]=new n(this)},n.prototype.getSyntax=function(t){if(t in this.syntaxLib)return this.syntaxLib[t];throw new Error("[Dialect getSyntax] This dialect hasn't syntax named "+t)},e.prototype.setSyntax=function(t){return this.list.push.apply(this.list,t),this},e.prototype.build=function(){for(var e=0,r=this.list.length,i=null,o=new n;e<r;e++)i=t("syntax/"+this.list[e]),o.extend(this.list[e],i);return o},e}),Md.extend("node",function(t){function n(t){this.__tag__=t?t:"",this.__attr__=new e,this.children=[]}var e=t("attr");return n.prototype.attr=function(t,n){return"undefined"==typeof n?this.__attr__.get(t):this.__attr__.add(t,n)},n.prototype.rmAttr=function(t){return this.__attr__.rm(t),this},n.prototype.appendChild=function(t){return this.children.push(t),this},n.prototype.toHtml=function(){var t=null,n=this.children,e=-1,r=n.length;for(""===this.__tag__?t=document.createDocumentFragment():(t=document.createElement(this.__tag__),this.__attr__.forEach(function(n,e){t.setAttribute(n,e)}));++e<r;)t.appendChild(n[e].toHtml());return t},n}),Md.extend("text-node",function(t){function n(t){this.text=t}return n.prototype.toHtml=function(){return document.createTextNode(this.text)},n}),Md.extend("syntax/block",function(t){function n(){this.lib=[]}var e=t("node");return n.prototype.extend=function(t){this.lib.push(t)},n.prototype.parse=function(t){var n,r=[t],i=null,o=this.lib.length,s=null,l=new e;do for(console.log("[Block parse1] ",t,r),t=r.pop(),console.log("[Block parse2] ",t,r),n=0;n<o;n++){if(i=[],s=this.lib[n].parse(t,i),console.log("[Block parse] try result ",s,i),i.length&&(i.reverse(),r.push.apply(r,i)),s){l.appendChild(s);break}i.length&&(t=r.pop())}while(r.length);return l},n.expend=function(t){expendGrammars.push(t)},n}),Md.extend("syntax/inline",function(t){function n(){this.lib=[]}var e=t("node");return n.prototype.extend=function(t){this.lib.push(t)},n.prototype.parse=function(t){var n,r=[t],i=null,o=this.lib.length,s=null,l=new e;console.log("[Inline parse]",t);do for(t=r.pop(),n=0;n<o;n++){if(i=[],s=this.lib[n].parse(t,i),i.length&&(i.reverse(),r.push.apply(r,i)),s){l.appendChild(s);break}i.length&&(t=r.pop())}while(r.length);return l},n}),Md.extend("syntax/combin-block",function(t){function n(t){this.block=t.getSyntax("block"),this.block.extend(this)}var e=t("node");return n.prototype.parse=function(t){var n=t.split(/(?:^\s*\n)/m),r=this;return console.log("[CombinBlock parse] ",n,n.length),n.length>1?function(){for(var t=new e,i=0,o=n.length;i<o;i++)t.appendChild(r.block.parse(n[i]));return t}():null},n}),Md.extend("syntax/atx-header",function(t){function n(t){var n=t.getSyntax("block");n.extend(this),this.inline=t.getSyntax("inline")}var e=t("node"),r=/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/;return n.prototype.parse=function(t,n){if(!r.test(t))return null;var i=t.match(r),o=new e("h"+i[1].length);return o.appendChild(this.inline.parse(i[2])),i[0].length<t.length&&n.push(t.substr(i[0].length)),o},n}),Md.extend("syntax/setext-header",function(t){function n(t){block=t.getSyntax("block"),block.extend(this),this.inline=t.getSyntax("inline")}var e=t("node");return n.prototype.parse=function(t,n){var r=/^(.*)\n([-=])\2\2+(?:\n|$)/,i=null,o="",s=null;return r.test(t)?(i=t.match(r),o="="===i[2]?"h1":"h2",s=new e(o),s.appendChild(this.inline.parse(i[1])),i[0].length<t.length&&n.push(t.substr(i[0].length)),s):null},n}),Md.extend("syntax/horiz-line",function(t){function n(t){var n=t.getSyntax("block");n.extend(this)}var e=t("node"),r={dash:"dash",underline:"underline",asterisk:"asterisk"};return n.prototype.parse=function(t,n){var i={s:t};console.log("[HorizLine parse] ",i);var o=/^(?:([\s\S]*?)\n)?[ \t]*(([-_*])(?:[ \t]*\3){2,})[ \t]*(?:\n([\s\S]*))?$/,s=t.match(o),l=null;if(!s)return null;if(s[1])return n.push(s[1]),n.push(s[2]),s[4]&&n.push(s[4]),null;switch(l=new e("hr"),s[3]){case"-":l.attr("class",r.dash);break;case"_":l.attr("class",r.underline);break;case"*":l.attr("class",r.asteris)}return s[4]&&n.push(s[4]),l},n}),Md.extend("syntax/paragraph",function(t){function n(t){block=t.getSyntax("block"),block.extend(this),this.inline=t.getSyntax("inline")}var e=t("node");return n.prototype.parse=function(t){var n=new e("p");return n.appendChild(this.inline.parse(t)),n},n}),Md.extend("syntax/escaped",function(t){function n(t){var n=t.getSyntax("inline");n.extend(this)}var e=t("text-node");return n.prototype.parse=function(t,n){var r=/\\([\\`\*_{}\[\]()#\+.!\-])/,i=r.exec(t);return r.test(t)?0===i.index?(n.push(t.substr(i[0].length)),new e(i[1])):(n.push(t.substring(0,i.index)),n.push(t.substr(i.index)),null):null},n}),Md.extend("syntax/inline-plain-text",function(t){function n(t){var n=t.getSyntax("inline");n.extend(this)}var e=t("text-node");return n.prototype.parse=function(t){return new e(t)},n}),Md.extend("dialects/office",function(t){var n=t("dialect-builder");return(new n).setSyntax(["block","inline","combin-block","atx-header","setext-header","horiz-line","paragraph","escaped","inline-plain-text"]).build()});